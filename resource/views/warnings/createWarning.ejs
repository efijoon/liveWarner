<style>
    table th {
      padding-top: 12px;
      padding-bottom: 12px;
      color: black;
    }

    .bidasks tr th,
    .bidasks tr td {
      padding: 10px;
      border-top: 1px solid #f1f1f1;
      vertical-align: middle;
      text-align: center;
      line-height: 1.4em;
    }

    .bidasks tr th.ask,
    .bidasks tr td.ask {
      color: #409b51;
    }

    .bidasks tr th.ask,
    .bidasks tr td.bid {
      color: #e62f2f;
    }

    .disableprice {
      color: #c2c2c2 !important;
      cursor: not-allowed;
    }
</style>

<div class="jumbotron">
    <div class="container">
      <h1 class="display-4 text-dark">بیانیه ریسک</h1>
      <p class="lead">بخش هشدارهای درون برنامه ای به درخواست کاربران راه اندازی گردیده، لازم است موارد زیر مدنظر باشد:</p>
      <ol>
          <li><span class="text-dark">هشدارها هم به صورت ایمیل و هم به صورت پیامک میباشند.</span></li>
          <li><span class="text-dark">هشدارها از نوع ایمیل در صورتی عمل میکنند که اینترنت شما برقرار باشد.</span></li>
          <li><span class="text-dark">ممکن است در حد 5 تا 10 دقیقه ای پس از زمان فعال شدن هشدار زمان ببرد تا هشدار به دست شما برسد.</span></li>
      </ol>
    </div>
  </div>

<div class="row justify-content-center">
    <button class="btn btn-success" data-toggle="modal" data-target="#create-warning-modal">ثبت هشدار جدید</button>
</div>

<div class="modal fade" id="create-warning-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" style="color: black;" role="document">
        <div class="modal-content" style="text-align: right;">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">انتخاب هشدار جدید</h5>
            </div>
            <div class="modal-body">
                <div class="menu">
                    <div class="panel overflow-hidden open">
                        <div class="h-100">
                            <div class="h-100 w-100">
                                <div class="d-flex flex-column h-100">
                                    <div class="header d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center justify-content-around text-reverse-50">
                                            <h6 class="mb-0 text-reverse mr-2">نام نماد</h6>
                                        </div>
                                        <div class="d-flex align-items-center text-muted"><span
                                                class="mdi mdi-24px mdi-alert-circle-outline px-2 text-muted"></span><span
                                                class="mdi p-2 mdi-24px text-primary mdi-close"></span>
                                        </div>
                                    </div>
                                    <!---->
                                    <div class="h-100 overflow-auto">
                                        <div class="overflow-auto flex-grow-1 check-for-scroll">
                                            <div class="position-relative stock-condition__search p-2">
                                                <input type="text" autocomplete="off"
                                                    placeholder="نماد مورد جستجو را وارد کنید" id="searchInputControl"
                                                    class="form-control ng-valid ng-touched ng-dirty">
                                                <!-- <button id="searchButtonControl"
                                                    class="form-control btn-info ng-valid ng-touched ng-dirty mt-3"
                                                    type="submit">جست و جو</button> -->
                                                <div class="invalid-feedback">نمادی انتخاب نشده است </div>
                                            </div>
                                        </div>
                                        <div>
                                            <form class="ng-pristine ng-invalid ng-touched">
                                                <div id="namad-details-container" style="display: none;"></div>
                                                <div id="bidaskTable" style="display: none;"></div>
                                                <div id="failed-message" style="display: flex;justify-content: center;">
                                                </div>

                                                <!---->
                                                <div class="row-list ng-pristine ng-invalid ng-touched">
                                                    <div class="p-2 font-weight-bold">تعیین شروط:</div>
                                                    <div class="row-list__item p-2">
                                                        <div
                                                            class="d-flex align-items-center position-relative ng-pristine ng-invalid ng-touched">
                                                            <div class="col-4 px-1 position-static">
                                                                <select formcontrolname="field"
                                                                    class="custom-select h-100 ng-pristine ng-valid ng-touched">
                                                                    <option value="0"> آخرین قیمت
                                                                    </option>
                                                                    <option value="1"> درصد تغییر قیمت
                                                                    </option>
                                                                    <option value="2"> حجم معاملات
                                                                    </option>
                                                                    <option value="3"> حجم تقاضا
                                                                    </option>
                                                                    <option value="4"> حجم عرضه
                                                                    </option>
                                                                    <option value="5"> قیمت پایانی
                                                                    </option>
                                                                    <option value="6"> درصد تغییر پایانی
                                                                    </option>
                                                                    <option value="7"> قیمت تقاضا
                                                                    </option>
                                                                    <option value="8"> قیمت عرضه
                                                                    </option>
                                                                    <option value="9"> ارزش معاملات
                                                                    </option>
                                                                    <!---->
                                                                </select>
                                                            </div>
                                                            <div class="px-1">
                                                                <select formcontrolname="operator"
                                                                    class="custom-select text-left h-100">
                                                                    <option value="0"> بزرگتر از
                                                                    </option>
                                                                    <option value="1"> بزرگتر یا مساوی
                                                                    </option>
                                                                    <option value="2"> کوچکتر از
                                                                    </option>
                                                                    <option value="3"> کوچکتر یا مساوی
                                                                    </option>
                                                                    <option value="4"> مساوی </option>
                                                                    <option value="5"> مخالف </option>
                                                                    <!---->
                                                                </select>
                                                            </div>
                                                            <div class="px-1">
                                                                <input type="text" name="customPrice"
                                                                    class="form-control text-left">
                                                            </div>
                                                        </div>
                                                        <div class="p-2">
                                                            <div>
                                                                <div
                                                                    class="d-flex justify-content-between align-items-center my-2">
                                                                    <label for="conditionName" class="m-0">عنوان
                                                                        هشدار:</label>
                                                                    <div class="custom-control custom-checkbox">
                                                                        <input type="checkbox" id="customCheck1"
                                                                            class="custom-control-input"><label
                                                                            for="customCheck1"
                                                                            class="custom-control-label">
                                                                            نام‌گذاری خودکار
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                                <!---->
                                                                <div class="px-2 font-weight-bold"
                                                                    style="min-height: 38px;">آخرین
                                                                    قیمت&nbsp;بزرگتر از&nbsp;<span
                                                                        dir="ltr">&nbsp;0</span></div>
                                                                <!---->
                                                                <div class="invalid-feedback">عنوان
                                                                    هشدار وارد نشده است </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            <div class="d-flex px-2 mb-2"><button type="submit"
                                                    class="btn btn-block btn-success ml-1 mt-2">ثبت
                                                    هشدار </button>
                                                <button type="submit" data-dismiss="modal" aria-label="Close"
                                                    class="btn btn-block btn-outline-danger mr-1 mt-2">انصراف</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<script>
    const searchBox = document.getElementById('searchInputControl');
    const detailsContainer = document.getElementById('namad-details-container');
    const bidaskTable = document.getElementById('bidaskTable');
    const failedMessage = document.getElementById('failed-message');
    
    searchBox.addEventListener('keyup', async (e) => {
        $.ajax({
            url: '/warnings/namadSearch',
            data: { name: searchBox.value },
            method: 'POST',
            success: (data) => {
                failedMessage.style.display = 'none';
                detailsContainer.style.display = 'block';
                bidaskTable.style.display = 'block';
                bidaskTable.style.background = detailsContainer.style.background = 'aliceblue';
                bidaskTable.style.borderRadius =  detailsContainer.style.borderRadius = '20px';
                detailsContainer.classList.add('my-4');

                detailsContainer.innerHTML = `
                    <div class="d-flex align-items-center p-2">
                        <div class="flex-grow-1">
                            <h6 class="mb-0 mr-2">${data.name}</h6>
                            <small class="text-muted mr-2">${data.data.desc}</small>
                        </div>
                        <div dir="ltr" class="h6 text-end mb-0">
                            <span> ${data.data.dealingPrice} </span>
                            <small class="${parseFloat(fixNumbers(data.data.dealingPricePercent)) >= 0 ? 'text-success' : 'text-danger' }"> (${data.data.dealingPricePercent}) </small>
                        </div>
                    </div>
                    <div class="d-flex align-items-center justify-content-between p-2 border-top">
                        <div class="no-wrap">
                            <span class="text-muted">قیمت پایانی:</span>
                            <span dir="ltr" class="${parseFloat(fixNumbers(data.data.lastPricePercent)) >= 0 ? 'text-success' : 'text-danger' }"> (${data.data.lastPricePercent})
                            </span>
                            ${data.data.lastPrice}
                        </div>
                        <div class="d-flex align-items-center">
                            <span class="text-muted ml-1">حجم:</span>
                            <span dir="ltr" class="d-block">${data.data.hajmMoamelat}</span>
                        </div>
                    </div>
                `;

                bidaskTable.innerHTML = `
                    <div class="d-flex align-items-center justify-content-between p-2">
                        <div class="flex-grow-1 text-center">
                            <h6>جدول خرید و فروش</h6>
                            ${data.data.bidaskTable}
                        </div>
                    </div>
                `
                ;
            },
            error: (req, status, error) => {
                detailsContainer.style.display = 'none';
                bidaskTable.style.display = 'none';
                failedMessage.style.display = 'flex';

                failedMessage.innerHTML = `<span class="badge badge-danger p-2 my-3">${req.responseText}</span>`
            }
        })

        function fixNumbers(str) {
            const persianNumbers = [/۰/g, /۱/g, /۲/g, /۳/g, /۴/g, /۵/g, /۶/g, /۷/g, /۸/g, /۹/g],
            arabicNumbers  = [/٠/g, /١/g, /٢/g, /٣/g, /٤/g, /٥/g, /٦/g, /٧/g, /٨/g, /٩/g];

            const replacePercent = str.replace('٪', '');
            let convertedStr = replacePercent.replace('٫', '.');

            if(typeof convertedStr === 'string') {
                for(var i=0; i < 10; i++) {
                    convertedStr = convertedStr.replace(persianNumbers[i], i).replace(arabicNumbers[i], i);
                }
            }

            return convertedStr;
        };
    })

</script>